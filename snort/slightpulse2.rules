# Copyright 2021 by FireEye, Inc.
# You may not use this file except in compliance with the license. The license should have been received with this file.

alert tcp any any -> any $HTTP_PORTS ( msg:"APT.Webshell.PL.SLIGHTPULSE.noalert"; flow:to_server; flowbits:isnotset,fb_nopulse2; flowbits:noalert; content:"img="; content:"name="; fast_pattern; pcre:"/(?:^|\x0d\x0a\x0d\x0a)(?:img=[^&]{0,256}&name|name=[^&]{0,256}&img)=/"; content:!"img.digitaldriver.com"; content:!" simg="; content:!"&dom."; content:!"PHPSESSID="; content:!"&Supl"; content:!"\; "; flowbits:set,fb_nopulse2; sid:99999908; rev:4; priority:40; )

alert tcp any $HTTP_PORTS -> any any ( msg:"APT.Webshell.PL.SLIGHTPULSE.2"; flow:to_client; flowbits:isset,fb_nopulse2; content:"HTTP/1."; depth:7; content:" 200"; distance:1; within:4; content:"|0d 0a|"; distance:0; within:5; content:"|0d 0a|Content-Disposition: attachment\; filename=tmp|0d 0a|"; fast_pattern; content:"|0d 0a|Content-Type: application/x-download|0d 0a|"; reference:date_created,2020-04-01; sid:99999909; )